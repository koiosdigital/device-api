// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
  engineType = "client"
}

datasource db {
  provider = "postgresql"
}

enum DeviceType {
  LANTERN
  MATRX
}

enum ClaimType {
  OWNER
  SHARED
}

model Device {
  id        String     @id
  type      DeviceType
  online    Boolean    @default(false)
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  // Relations
  settings DeviceSettings?
  deviceClaims DeviceClaims[]
  
  // Type-specific relations
  lanternGroupDevices LanternGroupDevices[]
  matrxApplets        MatrxApplets[]

  @@index([type])
  @@index([online])
}

model DeviceClaims {
  id        Int      @id @default(autoincrement())
  deviceId  String
  userId    String 
  claimType ClaimType 
  claimedAt DateTime @default(now())

  // Relations
  device Device @relation(fields: [deviceId], references: [id], onDelete: Cascade)

  @@unique([deviceId, userId])
  @@index([deviceId])
  @@index([userId])
}

model DeviceSettings {
  id          Int        @id @default(autoincrement())
  deviceId    String     @unique
  displayName String
  
  // Type-specific settings stored as JSON with validation
  typeSettings Json?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  device Device @relation(fields: [deviceId], references: [id], onDelete: Cascade)
}

model LanternGroup {
  id        Int      @id @default(autoincrement())
  name      String
  ownerId   String
  joinCode  String   @unique @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  devices LanternGroupDevices[]

  @@index([ownerId])
}

model LanternGroupDevices {
  id                 Int    @id @default(autoincrement())
  groupId            Int
  deviceId           String
  triggeredSetEffect String @default("solid")
  triggeredSetColor  String @default("#000000")
  createdAt          DateTime @default(now())

  // Relations
  group  LanternGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)
  device Device       @relation(fields: [deviceId], references: [id], onDelete: Cascade)

  @@unique([groupId, deviceId])
  @@index([groupId])
  @@index([deviceId])
}

model MatrxApplets {
  id              String   @id @default(uuid())
  deviceId        String
  appletData      Json
  enabled         Boolean  @default(true)
  skippedByUser   Boolean  @default(false)
  pinnedByUser    Boolean  @default(false)
  displayTime     Int      @default(0)
  sortOrder       Int      @default(0)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  device Device @relation(fields: [deviceId], references: [id], onDelete: Cascade)

  @@index([deviceId])
  @@index([deviceId, sortOrder])
  @@index([deviceId, enabled])
}