// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
  engineType = "client"
}

datasource db {
  provider = "postgresql"
}

enum DeviceType {
  LANTERN
  MATRX
}

model Device {
  id        String     @id
  type      DeviceType
  online    Boolean    @default(false)
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  // Relations
  settings DeviceSettings?
  
  // Type-specific relations
  lanternGroupDevices LanternGroupDevices[]
  matrxApplets        MatrxApplets[]

  @@index([type])
  @@index([online])
}

model DeviceSettings {
  id          Int        @id @default(autoincrement())
  deviceId    String     @unique
  displayName String
  
  // Type-specific settings stored as JSON with validation
  typeSettings Json?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  device Device @relation(fields: [deviceId], references: [id], onDelete: Cascade)
}

model LanternGroup {
  id        Int      @id @default(autoincrement())
  name      String
  ownerId   String   @map("owner_id")
  joinCode  String   @unique @default(cuid()) @map("join_code")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  devices LanternGroupDevices[]

  @@index([ownerId])
  @@map("lantern_groups")
}

model LanternGroupDevices {
  id                 Int    @id @default(autoincrement())
  groupId            Int    @map("group_id")
  deviceId           String @map("device_id")
  triggeredSetEffect String @default("solid") @map("triggered_set_effect")
  triggeredSetColor  String @default("#000000") @map("triggered_set_color")
  createdAt          DateTime @default(now())

  // Relations
  group  LanternGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)
  device Device       @relation(fields: [deviceId], references: [id], onDelete: Cascade)

  @@unique([groupId, deviceId])
  @@index([groupId])
  @@index([deviceId])
  @@map("lantern_group_devices")
}

model MatrxApplets {
  id              String   @id @default(uuid())
  deviceId        String
  appletData      Json
  enabled         Boolean  @default(true)
  skippedByUser   Boolean  @default(false) @map("skipped_by_user")
  pinnedByUser    Boolean  @default(false) @map("pinned_by_user")
  displayTime     Int      @default(0) @map("display_time")
  sortOrder       Int      @default(0) @map("sort_order")
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  device Device @relation(fields: [deviceId], references: [id], onDelete: Cascade)

  @@index([deviceId])
  @@index([deviceId, sortOrder])
  @@index([deviceId, enabled])
  @@map("matrx_applets")
}